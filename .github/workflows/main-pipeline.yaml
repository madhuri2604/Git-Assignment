name: Main Terraform WIF Workflow

on:
  push:
    branches: [main]

jobs:

  auth:
    uses: ./.github/workflows/auth.yaml
    permissions:
      id-token: write
      contents: read
    env:
      WIF_PROVIDER: ${{ secrets.GCP_WIF_PROVIDER }}
      WIF_SA: ${{ secrets.GCP_WIF_SERVICE_ACCOUNT }}
    with:
      workload_identity_provider: ${{ env.WIF_PROVIDER }}
      service_account: ${{ env.WIF_SA }}
      project_id: 'prj-gcp-inframod-01'

  terraform:
    needs: auth
    uses: ./.github/workflows/terraform.yaml

    with:
      resource_name: 'gcs'
      region: 'usc1'
      terraform_version: '1.8.5'
      credentials_json_b64: ${{ needs.auth.outputs.credentials_json_b64 }}
   

